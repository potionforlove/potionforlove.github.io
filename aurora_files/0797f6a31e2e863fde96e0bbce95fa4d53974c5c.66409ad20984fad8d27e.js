(window.webpackJsonp_N_E=window.webpackJsonp_N_E||[]).push([[17],{Fwix:function(e,t,n){"use strict";n.d(t,"a",(function(){return s}));var r=n("o0o1"),a=n.n(r),c=n("HaE+");function s(e,t){return o.apply(this,arguments)}function o(){return(o=Object(c.default)(a.a.mark((function e(t,n){var r,c,s,o;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,u(t);case 2:return r=e.sent,e.next=5,p(r);case 5:return c=e.sent,e.next=8,f(c,n);case 8:return s=e.sent,o=[],s.forEach((function(e,n){o.push({dataURL:e,name:t[n].name})})),e.abrupt("return",o);case 12:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function u(e){return i.apply(this,arguments)}function i(){return(i=Object(c.default)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map((function(e){return new Promise((function(t,n){var r=new FileReader;r.onload=function(e){var n=e.target.result;t(n)},r.readAsDataURL(e)}))})),e.next=3,Promise.all(n);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return l.apply(this,arguments)}function l(){return(l=Object(c.default)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.map((function(e){return new Promise((function(t,n){var r=new Image;r.onload=function(){t(r)},r.src=e}))})),e.next=3,Promise.all(n);case 3:return r=e.sent,e.abrupt("return",r);case 5:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e,t){return h.apply(this,arguments)}function h(){return(h=Object(c.default)(a.a.mark((function e(t,n){var r,c;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=document.createElement("canvas"),c=[],t.forEach((function(e){r.width=e.width,r.height=e.height,r.getContext("2d").drawImage(e,0,0,e.width,e.height),c.push(r.toDataURL("image/jpeg",.7))})),e.abrupt("return",c);case 4:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},"cIO+":function(e,t,n){"use strict";n.d(t,"a",(function(){return x}));var r=n("o0o1"),a=n.n(r),c=n("rePB"),s=n("HaE+"),o=n("q1tI"),u=n.n(o),i=n("20a2"),p=n("vDqi"),l=n.n(p),f=n("NyWP"),h=n("tV8m"),d=n("vHXl"),v=n("TzNB"),m=n.n(v),y=(n("Fwix"),n("IP2g")),b=n("8tEE"),g=u.a.createElement;function k(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function w(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?k(Object(n),!0).forEach((function(t){Object(c.default)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):k(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function x(e){var t=e||{},n=t.artistNameID,r=t.campaignID,u=t.mailingLists,p=t.actionsDisclaimer,v=Object(o.useState)({connected:!1,premium:!1,deviceFound:!1,activeDevices:[],accessToken:null,refreshToken:null,playing:null,ID:null}),k=v[0],x=v[1],O=Object(o.useState)({}),j=O[0],T=O[1],P=Object(o.useState)(!1),I=P[0],D=P[1],A=Object(o.useState)(!1),E=A[0],B=A[1],z=Object(i.useRouter)().asPath;function _(e,t){return N.apply(this,arguments)}function N(){return(N=Object(s.default)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U(t);case 2:r=e.sent,D(!1),C({accessToken:t,refreshToken:n,connected:!0,ID:r&&r.id||null,email:r&&r.email||null,premium:!(!r||"premium"!==r.product)}),document.cookie="accessToken=;path=/",document.cookie="refreshToken=;path=/";case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(){return(S=Object(s.default)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:fetch("/api/user-location").then((function(e){return e.json()})).then((function(e){var t={};if(u.map((function(e){t[e.ID]=!1})),"US"===e.location)for(var n in t)t[n]=!0;T(t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(){return(L=Object(s.default)(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Object.values(j).indexOf(!0)>-1&&h.c.collection("mailingLists").doc(n).collection(r).doc().set(w(w({timestamp:Math.floor(Date.now()/1e3)},j),{},{email:k.email}));case 2:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){x((function(t){return w(w({},t),e)}))}function U(e){return F.apply(this,arguments)}function F(){return(F=Object(s.default)(a.a.mark((function e(t){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.a.get("https://api.spotify.com/v1/me",{headers:{Authorization:"Bearer "+(t||k.accessToken)}});case 3:if((n=e.sent)&&n.data){e.next=6;break}return e.abrupt("return",null);case 6:return e.abrupt("return",n.data);case 9:return e.prev=9,e.t0=e.catch(0),console.log(e.t0.response),Z(e.t0,(function(){return U()})),e.abrupt("return",null);case 14:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function R(e){return V.apply(this,arguments)}function V(){return(V=Object(s.default)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.a.get("https://api.spotify.com/v1/me/player/devices",{headers:{Authorization:"Bearer "+(t||k.accessToken)}});case 3:if((n=e.sent)&&n.data){e.next=6;break}return e.abrupt("return",null);case 6:return r=[],n&&n.data&&n.data.devices&&n.data.devices.forEach((function(e){console.log(e),e.is_active&&r.push(e)})),e.abrupt("return",r);case 11:return e.prev=11,e.t0=e.catch(0),console.log(e.t0.response),Z(e.t0,(function(){return R()})),e.abrupt("return",null);case 16:case"end":return e.stop()}}),e,null,[[0,11]])})))).apply(this,arguments)}function W(){return(W=Object(s.default)(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.a.put("https://api.spotify.com/v1/me/player/repeat?state=context",{},{headers:{Authorization:"Bearer "+k.accessToken}});case 3:return e.abrupt("return",!0);case 6:return e.prev=6,e.t0=e.catch(0),t=e.t0.response.data.error.reason,console.log(t),e.abrupt("return",!1);case 11:case"end":return e.stop()}}),e,null,[[0,6]])})))).apply(this,arguments)}function H(){return(H=Object(s.default)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.a.put("https://api.spotify.com/v1/me/player/play",w({},t),{headers:{Authorization:"Bearer "+k.accessToken}});case 3:return C({playing:!0,deviceFound:!0}),e.abrupt("return",!0);case 7:if(e.prev=7,e.t0=e.catch(0),"NO_ACTIVE_DEVICE"!==e.t0.response.data.error.reason){e.next=13;break}return C({deviceFound:!1}),e.abrupt("return","NO_ACTIVE_DEVICE");case 13:return C({playing:!1}),e.abrupt("return",!1);case 15:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function q(e){return J.apply(this,arguments)}function J(){return(J=Object(s.default)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.a.get("https://api.spotify.com/v1/tracks/".concat(t),{headers:{Authorization:"Bearer "+k.accessToken}});case 3:return n=e.sent,r=n.data,console.log("track duration : ",r.duration_ms/1e3+" seconds"),e.abrupt("return",r);case 9:e.prev=9,e.t0=e.catch(0),console.log(e.t0),Z(e.t0,(function(){return q(t)}));case 13:case"end":return e.stop()}}),e,null,[[0,9]])})))).apply(this,arguments)}function M(){return G.apply(this,arguments)}function G(){return(G=Object(s.default)(a.a.mark((function e(){var t;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.a.get("https://api.spotify.com/v1/me/player",{headers:{Authorization:"Bearer "+k.accessToken}});case 3:t=e.sent,console.log(t),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.log(e.t0),Z(e.t0,(function(){return M()}));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)}function X(e){return K.apply(this,arguments)}function K(){return(K=Object(s.default)(a.a.mark((function e(t){var n,r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.a.get("https://api.spotify.com/v1/playlists/".concat(t,"/tracks"),{headers:{Authorization:"Bearer "+k.accessToken}});case 3:return r=e.sent,n=r.data.items,e.abrupt("return",n);case 8:e.prev=8,e.t0=e.catch(0),console.log(e.t0),Z(e.t0,(function(){return X(URI)}));case 12:case"end":return e.stop()}}),e,null,[[0,8]])})))).apply(this,arguments)}function Q(){return(Q=Object(s.default)(a.a.mark((function e(t){var n,r,c,s,o,u,i,p,f;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.name,r=t.description,c=t.publicPlaylist,s=t.tracks,e.prev=1,e.next=4,l.a.post("https://api.spotify.com/v1/users/".concat(k.ID,"/playlists"),{name:n,description:r,public:c},{headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+k.accessToken}});case 4:return o=e.sent,e.next=7,o.data.id;case 7:for(u=e.sent,i="https://api.spotify.com/v1/playlists/".concat(u,"/tracks?uris="),p=0;p<s.length;p++)f=s[p],i+=0===p?"".concat(f):",".concat(f);return e.next=12,l.a.post(i,{},{headers:{Authorization:"Bearer "+k.accessToken,"Content-Type":"application/json"}});case 12:return e.abrupt("return",u);case 15:return e.prev=15,e.t0=e.catch(1),console.log(e.t0),console.log(e.t0.response.data),e.abrupt("return",!1);case 20:case"end":return e.stop()}}),e,null,[[1,15]])})))).apply(this,arguments)}function Y(){return(Y=Object(s.default)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=n.replace("data:image/png;base64,",""),e.prev=1,e.next=4,l.a.put("https://api.spotify.com/v1/playlists/".concat(t,"/images"),r,{headers:{Authorization:"Bearer "+k.accessToken,"Content-Type":"image/jpeg"}});case 4:return e.sent,e.abrupt("return",!0);case 8:return e.prev=8,e.t0=e.catch(1),console.log(e.t0),e.abrupt("return",!1);case 12:case"end":return e.stop()}}),e,null,[[1,8]])})))).apply(this,arguments)}function Z(e,t){return $.apply(this,arguments)}function $(){return($=Object(s.default)(a.a.mark((function e(t,n){var r;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("The access token expired"!==t.response.data.error.message){e.next=12;break}return e.prev=1,e.next=4,l.a.get("/api/spotify/refresh_token",{params:{refresh_token:k.refreshToken}});case 4:(r=e.sent).data&&r.data.access_token&&C({accessToken:r.data.access_token}),n(r.data.access_token),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),console.log(e.t0);case 12:case"end":return e.stop()}}),e,null,[[1,9]])})))).apply(this,arguments)}function ee(){return(ee=Object(s.default)(a.a.mark((function e(t){var n,r,c,o,u;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=t.followArtists,r=t.followPlaylists,c=t.saveAlbums,o=t.saveTracks,u=t.followPodcasts,!n){e.next=10;break}return e.prev=2,e.next=5,l.a.put("https://api.spotify.com/v1/me/following?type=artist",{ids:n},{headers:{Authorization:"Bearer "+k.accessToken}});case 5:e.next=10;break;case 7:e.prev=7,e.t0=e.catch(2),console.log(e.t0);case 10:if(r&&r.forEach(function(){var e=Object(s.default)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,l.a.put("https://api.spotify.com/v1/playlists/".concat(t,"/followers"),null,{headers:{Authorization:"Bearer "+k.accessToken}});case 3:e.next=8;break;case 5:e.prev=5,e.t0=e.catch(0),console.log(e.t0);case 8:case"end":return e.stop()}}),e,null,[[0,5]])})));return function(t){return e.apply(this,arguments)}}()),!c){e.next=20;break}return e.prev=12,e.next=15,l.a.put("https://api.spotify.com/v1/me/albums",{ids:c},{headers:{Authorization:"Bearer "+k.accessToken}});case 15:e.next=20;break;case 17:e.prev=17,e.t1=e.catch(12),console.log(e.t1);case 20:if(!o){e.next=29;break}return e.prev=21,e.next=24,l.a.put("https://api.spotify.com/v1/me/tracks",{ids:o},{headers:{Authorization:"Bearer "+k.accessToken}});case 24:e.next=29;break;case 26:e.prev=26,e.t2=e.catch(21),console.log(e.t2);case 29:if(!u){e.next=38;break}return e.prev=30,e.next=33,l.a.put("https://api.spotify.com/v1/me/shows",{ids:u},{headers:{Authorization:"Bearer "+k.accessToken}});case 33:e.next=38;break;case 35:e.prev=35,e.t3=e.catch(30),console.log(e.t3);case 38:case"end":return e.stop()}}),e,null,[[2,7],[12,17],[21,26],[30,35]])})))).apply(this,arguments)}return Object(o.useEffect)((function(){u&&function(){S.apply(this,arguments)}();var e=(navigator.userAgent||navigator.vendor||window.opera).indexOf("Instagram")>-1;B(e)}),[]),Object(o.useEffect)((function(){k.connected&&function(){L.apply(this,arguments)}()}),[k.connected]),Object(o.useEffect)((function(){var e=Object(f.parseCookies)();e.accessToken&&_(e.accessToken,e.refreshToken)}),[]),{spotifyUser:k,updateSpotifyUser:C,spotifyFunctions:{getUserInfo:U,playMusic:function(e){return H.apply(this,arguments)},performActions:function(e){return ee.apply(this,arguments)},turnOnRepeat:function(){return W.apply(this,arguments)},getActiveDevices:R,createPlaylist:function(e){return Q.apply(this,arguments)},getPlaylist:X,getTrackInfo:q,getCurrentPlaybackData:M,addPlaylistImage:function(e,t){return Y.apply(this,arguments)}},spotifyLoginButton:function(e){var t=e||{},n=t.style,r=t.customStyle,i=t.label,l=t.useSVG;return n||(n=m.a),r||(r={}),g("form",{className:n.spotifyButtonWrapper+" "+r.spotifyButtonWrapper,action:"/api/spotify/v2/login",credentials:"include",method:"POST",target:"POPUPW",onSubmit:function(e){D(!0),window.open("about:blank","POPUPW","width=600,height=700,left=100,top=100"),window.addEventListener("message",function(){var e=Object(s.default)(a.a.mark((function e(t){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:"http://localhost:4000"!==t.origin&&"https://glitch.ge"!==t.origin&&"https://staging.glitch.ge"!==t.origin&&"http://192.168.0.115:4000"!==t.origin||_(t.data.accessToken,t.data.refreshToken);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}},g("input",{style:{display:"none"},id:"returnPage",name:"returnPage",value:z,readOnly:!0}),g("input",{style:{display:"none"},id:"isInstagram",name:"isInstagram",value:E,readOnly:!0}),g("button",{className:n.loginWithSpotify+" "+r.spotifyButton,disabled:k.connected,onClick:function(e){e.stopPropagation()}},I?g(d.a,null):g(o.Fragment,null,!l&&g("img",{className:n.spotifyLogo+" "+r.spotifyLogo,src:"/icons/music/spotify.svg"}),l&&g(y.a,{className:n.spotifyLogo+" "+r.spotifyLogo,icon:b.e}),g("span",{className:r.spotifyLabel},i||"Login with Spotify"))),u&&g("div",null,u.map((function(e){if(!1===j[e.ID]||!0===j[e.ID])return g("label",{className:n.checkbox,key:e.ID},g("input",{id:e.ID,type:"checkbox",checked:j[e.ID],onChange:function(t){var n=t.target.checked;T((function(t){return w(w({},t),{},Object(c.default)({},e.ID,n))}))}}),e.label)}))),p&&g("p",{className:n.instruction},p))}}}}}]);